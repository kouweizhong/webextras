@model WebExtras.JQDataTables.Datatable


@*
* This file is part of - WebExtras
* Copyright (C) 2013 Mihir Mone
*
* This program is free software: you can redistribute it and/or modify
* it under the terms of the GNU Lesser General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU Lesser General Public License for more details.
*
* You should have received a copy of the GNU Lesser General Public License
* along with this program.  If not, see <http://www.gnu.org/licenses/>.
*@

@using WebExtras.JQDataTables
<table class="dataTable table-bordered table-striped" id="@Model.ID">
  <thead>
    <tr>
      @foreach (DatatableColumn col in Model.Columns)
      {
        <th>@Html.Raw(col.Name)
        </th>
      }
    </tr>
  </thead>
</table>

<script type="text/javascript">    
    var dtSettings = @Html.Raw(Model.Settings.ToString() + ";")
    @{
      if (Model.Records != null && Model.Settings.bServerSide)
      {
        <text>
          dtSettings['bServerSide'] = false;
          dtSettings['sAjaxSource'] = null;
        </text>
      }
    }

    dtSettings.fnServerData = function(sSource, aoData, fnCallback) {
    @{
      foreach (PostbackItem item in Model.Postbacks)
      {
        <text>
          aoData.push({ name: '@item.name', value: '@item.value'});
        </text>
      }
    }
      $.getJSON(sSource, aoData, function(json) {
        fnCallback(json)
      });
    };

    @if(Model.EnableStatusColumn)
    {  
      <text>
        dtSettings.fnCreatedRow = function (nRow, aData, iDataIndex) {
          $(nRow).addClass(aData[aData.length - 1]);
        };
      </text>
    }
      
    @Html.Raw(string.Format("var {0}_tbl = $('#{0}').dataTable(dtSettings);", Model.ID))

    @{
      if (Model.Records != null)
      {
        <text>
          var firstPage = @Html.Raw(Model.Records.ToString())

          @Html.Raw(string.Format("oSettings = {0}_tbl.fnSettings();", Model.ID))
          oSettings.oFeatures.bServerSide = true;
          oSettings.sAjaxSource = '@Model.Settings.sAjaxSource';
          @Html.Raw(string.Format("{0}_tbl.oApi._fnAjaxUpdateDraw(oSettings, firstPage);", Model.ID))
        </text>
      }
    }
</script>